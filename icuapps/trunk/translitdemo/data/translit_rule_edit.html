<html>

<head>
<title>Transliteration Rule Editor</title>
<style type="text/css">
.wide    { width: 100% }
textarea { font-family: Arial Unicode MS; font-size: 100% }
</style>
</head>

<script src="../js/util.js"></script>

<script>
// Load user IDs from CGI
USER_IDS = "$USER_IDS".split(";");

// Generate options (inline) for SELECT element
function generateSelectIDOptions() {
  generateOptions(document.FORM.USER_IDS,
                  document.FORM._SELECT_ID_SELECTION.value);
}

// Handler to submit current window's rules.  We just delegate
// everything to the parent.
//|function submitRules() {
//|  var w = window.opener;
//|  if (!w.closed) {
//|    w.submitRules(window);
//|  }
//|}

//|// Rebuild the IDs selector
//|function refreshIDs() {
//|  var a = new Array();
//|  for (id in IDS) {
//|    a.push(id);
//|  }
//|  a.sort(ciSort);
//|  setOptions(document.FORM.SELECT_ID, a);
//|}

function handleSave() {
  var id = getSelectedOption(document.FORM.SELECT_ID);
  if (!id) {
    handleSaveAs();
    return;
  }
  document.FORM.ARG_OPERATION.value = "COMPILE";
  document.FORM.ARG_ID.value = id;
  document.FORM.ARG_RULES.value = document.FORM.USER_RULE.value;
  document.FORM.submit();
}

function handleSaveAs() {
  var id = prompt("Save this rule set as:", "");
  if (id) id = trimSpaces(id, 1);
  if (id) {
    document.FORM.ARG_OPERATION.value = "COMPILE";
    document.FORM.ARG_ID.value = id;
    document.FORM.ARG_RULES.value = document.FORM.USER_RULE.value;
    document.FORM.submit();
  }
}

function handleDelete() {
  var id = getSelectedOption(document.FORM.LOAD_IDS);
  if (confirm("Delete " + id + "?")) {
    document.FORM.ARG_OPERATION.value = "REMOVE";
    document.FORM.ARG_ID.value = id;
    document.FORM.submit();
  }
}

function handleSelectID() {
  var id = getSelectedOption(document.FORM.SELECT_ID);
  document.FORM._SELECT_ID_SELECTION.value = id;
  document.FORM.ARG_ID.value = id;
  document.FORM.submit();
}

function returnToParent() {
  alert("returnToParent()");
}

//|function setMode(m) { document.FORM.MODE.value = m; }
</script>

<body>
<font face="arial,helvetica,sanserif">

<!--
<form method="POST" action="/developerworks/opensource/icu/translitdemo" name="FORM">
<form method="POST" action="/cgi-bin/translit" name="FORM">
-->
<form method="POST" action="/cgi-bin/translit" name="FORM">
  <!-- MODE must be parsed before stdout -->
  <input type="hidden" name="MODE" value="$MODE">
  <input type="hidden" name="ARG_ID">
  <input type="hidden" name="ARG_RULES">
  <input type="hidden" name="ARG_OPERATION">
  <input type="hidden" name="_SELECT_ID_SELECTION" value="$_SELECT_ID_SELECTION">
  <table width="100%">
    <tr>
      <td width="10%">&nbsp;</td>
      <td width="80%" align="center"><strong><big><big><big>Transliteration Rule Editor</big></big></big></strong></td>
      <td width="10%" align="right"><a
      href="http://oss.software.ibm.com/icu/demo/translit_rule_help.html" target="_blank">Help</a></td>
    </tr>
  </table>
  <hr>
  <table width="100%">
    <tr>
      <td><table width="100%" cellspacing="0" cellpadding="0">
        <tr>
          <td width="97%">
          <select name="SELECT_ID" size="1" class="wide"
           onChange="handleSelectID()">
           <script>generateSelectIDOptions();</script>
          </select></td>
          <td width="1%">
          <input type="button" value="Save" onClick="handleSave()">
          </td>
          <td width="1%">
          <input type="button" value="Save As..." onClick="hansleSaveAs()">
          </td>
          <td width="1%">
          <input type="button" value="Delete" onClick="handleDelete()">
          </td>
        </tr>
      </table>
      </td>
    </tr>
    <tr>
      <td><textarea name="USER_RULE" rows="16" cols="20" class="wide">$USER_RULE</textarea></td>
    </tr>
    <tr>
      <td><b>$RESULT</b></td>
    </tr>
  </table>
<input type="hidden" name="TEMPLATE_FILE" value="data/translit_rule_edit.html">
</form>

<script>
//|// Load up custom rule IDs from the cookies.  Store these as
//|// keys in the hash IDS.
//|var ids = getCookieKeys();
//|IDS = new Object();
//|for (i=0; i<ids.length; ++i) {
//|  IDS[ids[i]] = 1;
//|}
//|refreshIDs();
//|
//|// Must assign the keyPress handler like this; can't do it in the element
//|//document.FORM.ID.onkeypress = trapEnter(save);
//|
//|// If this is an initial load, set up our start state
//|var mode = document.FORM.MODE.value;
//|if (mode == "") {
//|  document.FORM.RULES.value = "# Enter rules here or load an existing set of rules by selecting from the list above";
//|
//|  // Populate our fields, if we have previous values.  This may
//|  // overwrite RULES.
//|  //|window.opener.retrieveRules(window);
//|} else if (mode == "ERROR") {
//|  // The rules on the page are in error
//|  alert("There is a syntax error in the rules.  For details, see " +
//|        "the error message on the page.");
//|} else if (mode == "SAVED") {
//|  // The rules on the page are good; return to the parent page
//|  returnToParent();
//|}
//|
//|// Always reset the MODE to BUILD
//|//| document.FORM.MODE.value = "BUILD";
</script>

</font>

</body>
</html>
