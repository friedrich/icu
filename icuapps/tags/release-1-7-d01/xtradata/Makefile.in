RESFILESSRC=index.txt default.txt eo.txt mt.txt mt_MT.txt hi.txt hi_IN.txt id.txt ta.txt
RESFILES=$(RESFILESSRC:.txt=.res)
    
srcdir=@srcdir@
top_srcdir=@top_srcdir@

include @ICU_MAKEFILE@

top_builddir = ..
subdir = xtradata


GENRB=$(sbindir)/genrb
MAKECONV=$(sbindir)/makeconv

pkgdatadir = $(datadir)/$(PACKAGE)
ICUDATADIR=$(pkgdatadir)/$(VERSION)/

PATCHEDFILES=index.txt default.txt convrtrs.txt translit/index.txt

all:
	@echo This directory will install some updated, experimental data for the ICU.
	@echo 'To use it, run the following commands:'
	@echo 
	@echo '  1.  fetchOrigFiles /home/srl/icu/data/ '
	@echo '          (replace with the path to your source 'data' directory when you built the ICU)'
	@echo	
	@echo '  2.  make install-all'
	@echo
	@echo 'This will patch the following files: $(PATCHEDFILES) and install several new files.'

data:  $(RESFILES) convrtrs.txt
	ICU_DATA=$(ICUDATADIR) $(GENRB) translit/*.txt
	ICU_DATA=$(ICUDATADIR) $(GENRB) -elatin3 translit/lmaltese.txt
	ICU_DATA=$(ICUDATADIR) $(MAKECONV) *.ucm 
	cp convrtrs.txt $(ICUDATADIR)
	ICU_DATA=$(ICUDATADIR) $(sbindir)/gencnval convrtrs.txt

install-all: install-patches data install-data install-rebuild

install-data: data
	-cp *.res $(ICUDATADIR)
	-cp translit/*.res $(ICUDATADIR)/translit/

Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
	cd $(top_builddir) \
	 && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status


install-patches: convrtrs.txt.orig $(PATCHEDFILES)

install-rebuild: rebuildData.sh
	@./rebuildData.sh $(ICUDATADIR)/usascii.cnv $(ICUDATADIR)/ibm-954.cnv $(ICUDATADIR)/cnvalias.dat || echo "Hmm, problem re building data. Perhaps you didn't run fetchOriginalFiles.."

clean:
	-rm -rf *.res *.cnv translit/*.res $(PATCHEDFILES)

distclean: clean
	-rm -rf translit/*~ *~ *.orig translit/*.orig rebuildData.sh Makefile

%.txt : %.txt.orig %.txt.patch
	@cp $< $@
	patch < $@.patch


translit/index.txt: translit/index.txt.orig translit/index.txt.patch
	( cd translit ; cp index.txt.orig index.txt ; patch < index.txt.patch ) 
%.res : %.txt
	@echo Rebuilding $@
	@$(sbindir)/genrb $<
