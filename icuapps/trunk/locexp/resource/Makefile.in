## ******************************************************************************
## *
## *   Copyright (C) 1999-2000, International Business Machines
## *   Corporation and others.  All Rights Reserved.
## *
## *******************************************************************************

srcdir=@srcdir@
top_srcdir=@top_srcdir@

# srcdir must be set before this is included
include @ICU_MAKEFILE@

# the 'locexp' directory lives inside the exported ICU data dir..
lxdatadir= $(libdir)/$(PACKAGE)/$(VERSION)/locexp

## Build directory information
top_builddir = ../..
subdir = locexp/resource

## Extra files to remove for 'make clean'
CLEANFILES = *~ *.res  escapeABundle

# DEPS = $(OBJECTS:.o=.d)

# source files which are generated
GENSRC = root.txt index.txt

# resource files
# AUTOGEN - source whose encoding is detected
AUTOGENSRC = de.txt en.txt mt.txt el.txt ja.txt ru.txt it.txt fr.txt ta.txt hi.txt es.txt zh.txt

# ones which have a BOM can just go here
SRC    = sr.txt zh_SG.txt $(AUTOGENSRC)

ALLSRC = $(SRC) $(GENSRC)
RES = $(ALLSRC:.txt=.res)

%.res : %.txt
	@echo Rebuilding $@
	$(INVOKE) $(sbindir)/genrb -v -d. $<

## List of phony targets
.PHONY : all all-local install install-local clean clean-local \
distclean distclean-local dist dist-local check check-local res-local

## Clear suffix list
.SUFFIXES :


## List of standard targets
all:  all-local
install:  install-local
clean:  clean-local
distclean :  distclean-local
dist:  dist-local
check:  check-local

all-local: res-local root_SAMPLE.txt

res-local: Makefile.res $(RES)

Makefile.res: Makefile.in detectEncodings.sh $(AUTOGENSRC)
	./detectEncodings.sh $(AUTOGENSRC)

-include Makefile.res



root.txt: ../locexp.c root.txt.inc ../tools/extractStrings.sh
	env PATH=../tools:../../uconv:$(PATH) extractStrings.sh ../locexp.c > ../resource/root.txt || ( rm -f root.txt ; false )

index.txt: Makefile.in $(SRC) ../tools/genIndex.sh
	../tools/genIndex.sh $(SRC) root.txt > index.txt


install-local: install-res

tmp/locexp.lst: Makefile
	@$(MKINSTALLDIRS) tmp
	@-$(RMV) $@
	@for file in $(RES); do \
	  echo `pwd`/$$file >> $@; \
	done;

resinst: $(RES) tmp/locexp.lst
	$(INVOKE) $(sbindir)/pkgdata -p locexp -O @ICU_MAKEFILE@ -m common -v -c -d $(libdir)/$(PACKAGE)/$(VERSION) -T tmp tmp/locexp.lst


# Force creation of locexp as a DLL
resdllinst: $(RES) tmp/locexp.lst
	$(INVOKE) $(sbindir)/pkgdata -p locexp -O @ICU_MAKEFILE@ -m dll -v -c -d $(libdir)/$(PACKAGE)/$(VERSION) -T tmp tmp/locexp.lst

install-res: res-local resdllinst

dist-local:

clean-local:
	test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
	rm -f $(GENSRC)

distclean-local: clean-local
	rm -f Makefile 

check-local:

Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
	cd $(top_builddir) \
	 && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status

#sr.txt:  sr.utf16.txt escapeABundle
#	../../uconv/uconv -f utf-16le -t utf-16be < sr.utf16.txt | escapeABundle > sr.txt || rm -f sr.txt

sr.res : sr.txt
	@echo Rebuilding $@ - utf-16le
	@$(INVOKE)  $(sbindir)/genrb -d. -eutf-16le $<

escapeABundle: escapeABundle.c
	cc -o escapeABundle escapeABundle.c


root_SAMPLE.txt: root.txt
	echo "// Generated copy of root.txt. Also look at 'en.txt'." > root_SAMPLE.txt
	cat < root.txt >> root_SAMPLE.txt

